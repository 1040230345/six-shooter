<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>六发左轮-面向小型开发团队的项目协作开发系统</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- 触屏缩放 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 禁止缩放
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    -->
    <style type="text/css">
        /*signin样式*/
        body {
            padding-top: 40px;
            padding-bottom: 40px;
            background-color: #eee;
        }

        .form-signin {
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }
        .form-signin .form-signin-heading,
        .form-signin .checkbox {
            margin-bottom: 10px;
        }
        .form-signin .checkbox {
            font-weight: normal;
        }
        .form-signin .form-control {
            position: relative;
            height: auto;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
        }
        .form-signin .form-control:focus {
            z-index: 2;
        }
        .form-signin input[type="email"] {
            margin-bottom: -1px;
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }
        .form-signin input[type="password"] {
            margin-bottom: 10px;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        /*分割*/


        .myhide{
            display: none;
            /*position: absolute;*/
            /*top: 40px;*/
            /*left: 183px;*/
        }
        .form-control{
            margin: 5px 0;
        }
        #ok,#fxck,#pass{
            position: relative;
        }
        #emailmsg,#namemsg,#passmsg{
            position: absolute;
            left: 304px;
            top: -41px;
            width: 180px;
        }
        /*#ok{*/
        /*    position: absolute;*/
        /*}*/
    </style>
    <script type="text/javascript">
    $(document).ready(function() {
            
            $("#signupbtn").click(function(){
                $("#signin").fadeOut(300);
                $("#signup").fadeIn();
            });
            $("#returnbtn").click(function(){
                $("#signin").fadeIn();
                $("#signup").hide();
            });


            var flag1;
            var flag2;
            var flag3;
            var checkemail=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/||/\s/;
            var checkname=/^[\u4e00-\u9fa5A-Za-z0-9-_]*$/||/\s/;
            $("#signupEmail").focus(function(){

                $(this).keyup(function(event) {
                    flag1=null;
                    var text=$(this).val();
                    if(!checkemail.test(text)||text==null){
                        $("#emailmsg").html("邮箱格式错误"+"<span class='glyphicon glyphicon-remove' id='icon1'></span>");
                        flag1=false;
                         $("#emailmsg").css('color', 'red');
                        $("#signupSub").attr('disabled',true);
                        $("#icon1").attr('class', 'glyphicon glyphicon-remove');

                    }else{
                        $.ajax({
                            url: '/verification',
                            type: 'post',
                            dataType: 'JSON',
                            data: {email: text},
                        })
                            .done(function(data) {
                                if(data.email=="0"){
                                    $("#signupSub").attr('disabled',true);
                                    $("#emailmsg").html("此邮箱存在"+"<span class='glyphicon glyphicon-remove' id='icon1'></span>");
                                     $("#emailmsg").css('color', 'red');

                                    flag1=false;
                                    $("#icon1").attr('class', 'glyphicon glyphicon-remove');
                                }else{
                                    flag1=true;
                                    $("#emailmsg").html("<span class='glyphicon glyphicon-remove' id='icon1'></span>");
                                     $("#emailmsg").css('color', 'green');
                                    $("#icon1").attr('class', 'glyphicon glyphicon-ok');
                                }
                                if(flag1&&flag2&&flag3){
                                $("#signupSub").attr('disabled',false);}
                            })
                            .fail(function() {
                                console.log("error");
                            })
                            .always(function() {
                                console.log("complete");
                            });
                            
                    }
                        
                });

            });
            $("#signupUsername").focus(function(){
                $(this).keyup(function(event) {
                    flag2=null;
                    var text=$(this).val();
                    if(!checkname.test(text)||text==null||text==""){
                        console.log("用户名格式错误");
                         $("#namemsg").html("用户名包含非法字符"+"<span class='glyphicon glyphicon-remove' id='icon2'></span>");
                         $("#namemsg").css('color', 'red');
                        flag2=false;
                        $("#signupSub").attr('disabled',true);
                    }else{
                        $.ajax({
                            url: '/verification',
                            type: 'post',
                            dataType: 'JSON',
                            data: {name: text},
                        })
                            .done(function(data) {
                                if(data.name=="0"){
                                    $("#signupSub").attr('disabled',true);
                                     $("#namemsg").html("此用户名存在"+"<span class='glyphicon glyphicon-remove' id='icon2'></span>");
                                    $("#namemsg").css('color', 'red');

                                    flag2=false;
                                    $("#icon2").attr('class', 'glyphicon glyphicon-remove');
                                }else{
                                    flag2=true;
                                    $("#namemsg").html("<span class='glyphicon glyphicon-remove' id='icon2'></span>");
                                    $("#namemsg").css('color', 'green');
                                    $("#icon2").attr('class', 'glyphicon glyphicon-ok');
                                }
                                if(flag1&&flag2&&flag3){
                                $("#signupSub").attr('disabled',false);}
                            })
                            .fail(function() {
                                console.log("error");
                            })
                            .always(function() {
                                console.log("complete");
                            });

                    }
                        
                });

            });
            $("#signupPassword").focus(function(){
                $(this).keyup(function(event) {
                    flag3=null;
                    var text=$(this).val();
                    if (text=="") {
                        $("#passmsg").html("<span class='glyphicon glyphicon-remove' id='icon3'></span>");
                        $("#passmsg").css('color', 'red');
                        flag3=false;
                        $("#signupSub").attr('disabled',true);
                    }else{
                        flag3=true;
                        $("#passmsg").html("<span class='glyphicon glyphicon-remove' id='icon3'></span>");
                        $("#passmsg").css('color', 'green');
                        $("#icon3").attr('class', 'glyphicon glyphicon-ok');
                    };
                    if(flag1&&flag2&&flag3){
                    $("#signupSub").attr('disabled',false);}
                });
            });
           
        });
    </script>
</head>
<body>
    <div class="container" id="signin">

        <form class="form-signin" id="signinform" action="/login" method="post" accept-charset="utf-8" onsubmit="document.charset='utf-8'">
            <h2 class="form-signin-heading">请登录</h2>
            <label for="inputEmail" class="sr-only">Email address</label>
            <input type="text" id="inputEmail" class="form-control" placeholder="Email address" required="" autofocus="">
            <label for="inputPassword" class="sr-only">Password</label>
            <input type="password" id="inputPassword" class="form-control" placeholder="Password" required="">
            <div class="checkbox">
                <label>
                    <input type="checkbox" value="remember-me">Remember me</label>
            </div>
            <button class="btn btn-lg btn-primary btn-block" type="submit">登录</button>
            <button class="btn btn-lg btn-primary btn-block" id="signupbtn">注册</button>
        </form>

    </div>

    <div class="myhide" id="signup">
        <div class="container">
            <form class="form-signin" id="signupform" action="/register" method="post" accept-charset="utf-8" onsubmit="document.charset='utf-8'">
                <h2 class="form-signin-heading">请注册</h2>
                <label for="inputEmail" class="sr-only">Email address</label>
                <input type="text" name = "email" id="signupEmail" class="form-control" placeholder="Email address" required="" autofocus="">
                <div id="ok">
                    <h6 id="emailmsg"></h6>
                </div>
                <label for="inputPassword" class="sr-only">Username</label>
                <input type="text" name = "name" id="signupUsername" class="form-control" placeholder="Username" required="">

                <div id="fxck">
                    <h6 id="namemsg"></h6>
                </div>

                <label for="inputPassword" class="sr-only">Password</label>
                <input type="text" name = "password" id="signupPassword" class="form-control" placeholder="Password" required="">
                <div id="pass">
                    <h6 id="passmsg"></h6>
                </div>

                <button class="btn btn-lg btn-primary btn-block" type="submit" disabled="true" id="signupSub">提交</button>

                <button class="btn btn-lg btn-primary btn-block" id="returnbtn">返回</button>
            </form>
        </div>
    </div>
</body>
</html>